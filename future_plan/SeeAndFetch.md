### SeeAndFetch：未来整体开发目标与阶段性调试目标

> 前提约束：桌面固定；允许在桌面/区域贴少量小贴纸（作为公共基准，不要求给每个物体贴）；末端单目摄像头；夹爪独立舵机可控位置；目标类型较多样，先从规则物体测起；放置在一定区域内即可。

### 1. 整体开发目标（What / Why）
- **核心闭环目标**：用户通过手势“指明要抓取的目标”→机械臂给出明确响应（已锁定/将执行）→用户再指明“放置区域/位置”→机械臂完成抓取与放置，并能在失败时安全回退。
- **可靠性优先**：宁可动作慢一点，也要少误抓、少撞击、可中止、可恢复、可复现。
- **可调试与可验收**：任何关键决策都能在日志中解释（选中哪个目标、置信度、阈值、状态机状态、失败原因），并能导出参数与记录证据（截图/日志）。

### 2. 技术路线概览（How）
- **交互层**：使用手势识别库实现“两指指点 + 确认/取消/急停”。
- **识别层**：当前先用 **OpenCV DNN** 运行 ONNX 检测模型输出 $(u, v)$ 像素坐标（后续可按需要替换为 ONNX Runtime，但对上层接口不产生破坏）。
- **定位层（Kinematics 联动）**：利用已实现的 **ArmKinematics** 模型，结合摄像头外参 ($T_{cam}^{ee}$)，将像素坐标映射为 Base 坐标系的 $(x, y, z)$ 目标。
- **闭环层**：采用“边靠近边看”的视觉伺服策略：先在上方对准、再垂直下探、丢失就回退。

### 3. 里程碑规划（阶段目标 + 调试验收要点）

#### 阶段 0：运动学底座与操作台（已完成 2025-12-25）
- **目标**：实现笛卡尔空间移动、IK 解优化、UI 自适应布局、Jog 交互。
- **验收**：通过键盘/鼠标能流畅控制机械臂移动；位姿反馈准确；UI 在缩放时布局稳定。

#### 阶段 1：视觉计算接入（可闭环验证）（已完成 2025-12-25）
- **目标**：在不影响预览流畅度的前提下，把“每帧视觉结果”稳定产出到 UI/日志，并能驱动现有 Visual Servo 闭环做桌面验收。
- **调试目标**：
  - **帧旁路**：相机帧进入视觉线程，`OnReadSample` 不做重计算（避免掉帧）。
  - **闭环验证**：点击画面/最亮点/色块/ArUco/Detector/手势等模式输出 `VisualObservation`，验证 `VisualServoController` 输出稳定、HUD 正确、无数据拖尾。
  - **参数持久化**：视觉参数纳入 `.ini` 导入导出，支持导入后热更新（便于实验室/宿舍复现一致参数）。
- **与运动学联动接口（新增）**：
  - **观测结构**：视觉线程输出 `VisualObservation`（目标像素 u/v、可选深度 depthMm、可选指向射线 rayXYZ、置信度、时间戳）。
  - **控制模块**：`VisualServoController` 计算 `VisualServoOutput`（归一化 XYZ + pitch），并用 `ApplyToJog()` 喂给现有 `JogController` 完成 IK + 下发。
  - **控制策略**：支持 `CenterTarget`（居中）、`FollowRay`（沿指向前进/后退）、`LookAndMove`（先居中再推进）。
  - **文档**：`guide_docs/视觉协同跟随与沿指向运动-接口设计.md`
- **验收**：开启视觉模块不影响预览；日志中持续输出识别摘要；`VS Enable` 打开后可通过点击/道具在无机械臂场景完成闭环验收。

#### 阶段 1.5：工程化与团队同步（依赖/环境/离线包）（已完成 2025-12-26）

- **目标**：让队友“拉代码即可编译”，网络慢也能通过离线包快速同步三方库。
- **关键点**：
  - **vcpkg manifest**：依赖写在 `vcpkg.json`（Eigen3/OpenCV4[contrib]/Ceres），构建期自动安装。
  - **OpenCV 生效可见**：主界面 `VS:` 行显示 `cv=Y/N`，用于快速定位“库是否进编译环境”。
  - **中文路径坑规避**：依赖安装目录固定为 `$(USERPROFILE)\vcpkg_installed\`（纯英文），避免 vcpkg 内部工具在中文路径下异常退出。
  - **离线同步策略（QQ 传输）**：
    - 方案A：打包 `C:\vcpkg\` + `C:\Users\你的用户名\vcpkg_installed\`（最省心，体积大）
    - 方案B：打包 `C:\vcpkg\downloads\` + `C:\Users\你的用户名\AppData\Local\vcpkg\archives\`（更小，但队友首次可能仍需编译部分包）

#### 阶段 2：目标锁定与交互状态机（只锁定/不抓取）
- **目标**：用户可以稳定地“选中一个目标（锁定）”，并能明确取消/急停；视觉多目标时有可解释的选择逻辑。
- **调试目标**：
  - **锁定状态机**：Acquire → Track（至少做到“丢失 N 帧自动退出 Track”）。
  - **交互回执**：UI/HUD 显示“已锁定哪个目标、置信度、丢失原因”，并支持一键取消/急停。
  - **多目标选择**：支持“最近点击/最大框/最高置信度”之一的策略，并在日志中解释选择原因。
- **验收**：多次选择不误触发；锁定/取消/急停逻辑可靠；日志可复现。

#### 阶段 3：视觉伺服抓取（先抓规则物体，先保证不翻车）
- **目标**：从“锁定目标”到“完成夹取并抬起”，形成可回退的抓取技能。
- **调试目标**：
  - **分段动作**：观察位 → 对准位 → 慢速下探（IK 实时微调）→ 闭合。
  - **丢失保护**：目标丢失 N 帧即停止下探并回到上方安全位。
- **验收**：对方块/圆柱能稳定夹起；出现异常能安全退出。

#### 阶段 4：区域放置与工程化
- **目标**：用户选择放置区域，机械臂完成放置并退回。
- **调试目标**：
  - **参数持久化**：将所有视觉阈值、抓取高度、外参等纳入 `.ini` 导入导出。
  - **自动回归**：利用模拟串口验证状态机鲁棒性。
- **验收**：多次执行任务稳定；演示时可快速切换环境参数。

### 3.1 下一阶段的工程化切入点（建议按顺序）

- **状态机骨架先落地**：Acquire/Track/Abort/EStop 等状态明确，先不追求抓取成功率，先追求“可解释 + 可中止 + 可复现”。
- **日志与证据**：每个关键决策都能在日志中解释（选择哪个目标、为什么、何时丢失、为何退出），并能配合截图/录屏复盘。
- **参数与预设**：把“实验室/宿舍”两套参数作为 `.ini` 预设，靠导入导出一键切换。

### 4. 交付物建议
- **视频演示**：展示从手势指点到物体抬起的完整全自动化流程。
- **参数预设**：提供一份“完美标定”的 `.ini` 配置文件供快速复现。
