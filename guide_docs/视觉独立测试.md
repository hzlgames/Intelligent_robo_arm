# 视觉独立测试（仅摄像头，不联动运动）

本文档用于在不联动机械臂运动的前提下，单独验收以下视觉能力：

- **目标追踪**：`Detector(ONNX/OpenCV DNN)` 输出检测框 + 中心点 + 置信度
- **深度信息判断**：`ArUco` 输出 `Depth=xxxmm` 并分档 `Near/Mid/Far`
- **手势识别**：`HandLandmarks` 输出 21 点骨架 + `OpenPalm/Fist/Point/Pinch/Unknown`

## 1. UI 开关（必须先确认）

主界面右侧（VS 区域）新增了两个与视觉相关的开关：

- **识别启用**：只控制 `VisionService` 是否产出识别结果（与 `VS Enable` 解耦）
- **仅测试(不驱动)**：即使你误开了 `VS Enable`，也不会把视觉输出写入 `JogController`（默认建议开启）

建议测试时：

- `识别启用`：勾选
- `仅测试(不驱动)`：勾选
- `VS Enable`：不勾选（只测视觉时不需要）

## 2. 模式选择与画面叠加

在右侧下拉框 **“识别：”** 中选择算法：

- `Detector(ONNX/OpenCV DNN)`：画面会叠加检测框、中心点与 `conf`
- `ArUco`：画面会叠加 `Depth=xxxmm Near/Mid/Far`
- `手部关键点(HandLandmarks)`：画面会叠加 21 点骨架与 `Gesture=...`

> 提示：若画面没有叠加，请确认你勾选了 **识别启用**，且模型/参数已配置正确。

## 3. INI 配置（导入/导出）

本项目支持把视觉参数导入/导出到 ini（对应 `SettingsIo`）。

### 3.1 通用视觉开关

- `Vision\ProcEnabled=1`：识别启用
- `Vision\NoDrive=1`：仅测试（不驱动）
- `Vision\Mode`：
  - `0=Auto`
  - `1=BrightestPoint`
  - `2=Aruco`
  - `3=ColorTrack`
  - `4=Detector`
  - `5=HandSticker(双色贴纸)`
  - `6=HandLandmarks(关键点)`

### 3.2 ArUco 深度分档

- `Vision\Aruco\MarkerLengthMm=40`
- `Vision\Depth\NearMm=120`
- `Vision\Depth\FarMm=220`

### 3.3 Detector(ONNX)（已有）

- `Vision\Detector\OnnxPath=...`
- `Vision\Detector\InputW=320`
- `Vision\Detector\InputH=320`
- `Vision\Detector\Conf_milli=500`
- `Vision\Detector\Nms_milli=400`

### 3.4 HandLandmarks（需要你准备 2 个 ONNX）

推荐使用 OpenCV Zoo 的 MediaPipe Hands 模型：

- `palm_detection_mediapipe_2023feb.onnx`
- `handpose_estimation_mediapipe_2023feb.onnx`

对应 ini 键：

- `Vision\Hand\PalmOnnxPath=...`
- `Vision\Hand\LandmarkOnnxPath=...`
- `Vision\Hand\PinchThreshNorm_milli=250`（捏合阈值，归一化 0..1000；越大越容易判定 Pinch）

模型来源（请用浏览器下载到本机任意路径）：

- [OpenCV Zoo: palm_detection_mediapipe](https://github.com/opencv/opencv_zoo/tree/main/models/palm_detection_mediapipe)
- [OpenCV Zoo: handpose_estimation_mediapipe](https://github.com/opencv/opencv_zoo/tree/main/models/handpose_estimation_mediapipe)

## 4. 验收建议（最短路径）

- **Detector**：把手机/杯子等目标放入画面，看到框与中心点稳定跟随；移动目标验证不乱跳。
- **AruCo 深度**：打印/显示 ArUco 码，前后移动看到 `Depth` 数值变化，且分档 `Near/Mid/Far` 切换合理。
- **HandLandmarks**：手进入画面，看到 21 点骨架稳定；做 `OpenPalm/Fist/Point/Pinch`，文字标签变化符合预期。


